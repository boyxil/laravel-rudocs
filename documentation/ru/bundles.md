# Bundles

## Contents

- [Основы](#the-basics)
- [Создание бандла](#creating-bundles)
- [Регистрация бандлов](#registering-bundles)
- [Загрузка бандлов и классов](#bundles-and-class-loading)
- [Запуск бандла](#starting-bundles)
- [Маршруты в бандлах](#routing-to-bundles)
- [Использование бандлов](#using-bundles)
- [Ресурсы бандлов](#bundle-assets)
- [Установка бандлов](#installing-bundles)
- [Обновление бандлов](#upgrading-bundles)

<a name="the-basics"></a>
## The Basics

Пакеты (далее бандлы) стали основным улучшением, внедренным в Laravel с версии 3.0. Это великолепное срество упаковывать код в функциональные пакеты. Бандля имеют все возможности приложения - свои пердставления, конфигурацию, маршруты, миграции, задачи и все остальное, присущее приложению Laravel. Бандлом может быть все - от ORM базы данных и до развитой системы аутентификации. Тем самым обеспечивают уникальную возможность построения модульных систем на базе Laravel. Во многих случаях вы можете воспринимать папку с приложением, как специальный бандл по умолчанию в Laravel, заранее запрограммированный и загруженный для использования.

<a name="creating-and-registering"></a>
## Создание бандла

Первым шагом создания бандла является создание его одноименной папки в вашей **bundles** директории.
Например, вы создаете "admin" бандл, который будет заниматься администрированем сайтом (панель управления).
Файл **application/start.php** заведует некоторыми конфиграционными настройками нашего приложения. По образу и подобию в создаете файл **start.php** в директории бандла (в данном случае **bundles/admin**). Он будет запущен при каждой загрузке бандла. Создадим его:

#### Создание файла start.php бандла:

	<?php

	Autoloader::namespaces(array(
		'Admin' => Bundle::path('admin').'models',
	));

В начале файла мы указали авто-загрузчику, что классы, которые в пространстве имен "Admin" должны быть загружены из каталога 'models' нашего бандла. Вы можете делать все, что угодно в начале файла, но обычно он используется для регистрации классов с автоматическим загрузчиком. ** На самом деле, теперь вы уже не обязаны создавать файл start.php бандла.**

Далее мы увидим, как зрегистрировать бандл в приложении!

<a name="registering-bundles"></a>
## Регистрация бандла

Теперь, когда у нас есть бандл 'admin', нужно его зарегистрировать в Laravel. Откройте файл **application/bundles.php**. Здесь регистрируются все бандлы приложения. Просто добавьте в массив:

#### Регистрация бандла:

	return array('admin'),

По соглашению, подразумевается, что бандл (в данном случае 'admin') расположен в директории 'bundle' Laravel, но, если это необходимо, вы можете разместить бандл где угодно:

#### Регистрация бандла в определенной директории:

	return array(

		'admin' => array('location' => 'userscape/admin'),

	);

Теперь Laravel будет искать наш бандл в **bundles/userscape/admin**.

<a name="bundles-and-class-loading"></a>
## Загрузка бандлов и классов

Как правило, файл бандла **start.php** содержит только объявление автозагрузки. Тогда можно не создавать этот файл, а внести эти инструкции прямо в массив объявления пакета в **application/bundles.php**. Например:

#### Объявление карты автозагрузки при регистрации бандла:

	return array(

		'admin' => array(
			'autoloads' => array(
				'map' => array(
					'Admin' => '(:bundle)/admin.php',
				),
				'namespaces' => array(
					'Admin' => '(:bundle)/lib',
				),
				'directories' => array(
					'(:bundle)/models',
				),
			),
		),

	);

Обратите внимание, что каждый из элементов массива соответствует определенному методу автозагрузчика Laravel [auto-loader](/docs/loading). На самом деле все объявления автоматически передаются в автозагрузчик.

Вы наверняка заметили **(:bundle)** конструкцию. По соглашению, это конструкция автозамены, при помощи которой автоматически вставляется путь к бандлу. Еще одна изюминка.

<a name="starting-bundles"></a>
## Запуск бандла

Итак, наш бандл готов и зарегистрирован, но мы пока не можем его использовать. Для этого нам нужно его запустить:

#### Запуск бандла:

	Bundle::start('admin');

Эта указание Laravel запустить файл **start.php** бандла, котоорый зарегистрирует классы бандла в автозагрузчике. Также при этом загружается файл **routes.php** с маршрутами и фильтрами бандла, если этот файл присутствует.

> **Примечание:** Бандл стартует только один раз.Все остальные попытки старта будут проигнорированы.

Если вы используете бандл повсеместно в приложении, вам он может понадобиться при каждом запросе. Тогда вы просто обявляете для этого бандла режим авто-старта в файле **application/bundles.php**:

#### Конфигурация бандла для автостарта:

	return array(

		'admin' => array('auto' => true),

	);

Не всегда нужно явно указывать запуск бандла. На самом деле, удобнее объявить автозапуск бандла, и Laravel позаботится об остальном. Например, как только вы запросите использование любого компонента бандла (представления, маршрута, фильтра и т.п.), бандл автоматически будет запущен!

При каждом старте бандл активирует событие. Вы можете отслеживать это:

#### Отслеживание события старта бандла:

	Event::listen('laravel.started: admin', function()
	{
		// The "admin" bundle has started...
	});

И, наконец, бандл можно вообще отключить инструкцией "disable".

#### Отключение бандла:

	Bundle::disable('admin');

<a name="routing-to-bundles"></a>
## Маршруты бандлов

Эти вопросы освещены в [Маршруты бандлов](/docs/routing#bundle-routes) и [контроллеры бандлов](/docs/controllers#bundle-controllers).

<a name="using-bundles"></a>
## Использование бандлов

Как было указано ранее, бандлы могут иметь представления, конфигурационные файлы, языковые и другие файлы. Laravel использует синтаксис двойного двоеточия для загрузки этих элементов. Например:

#### Загрузка представления бандла:

	return View::make('bundle::view');

#### Загрузка конфигурационного файла:

	return Config::get('bundle::file.option');

#### Загрузка языкового варианта:

	return Lang::line('bundle::file.line');

Иногда вам может понадобиться получить разную информацию о бандле, например, существует ли бандл, где он находится, его конфигурационный массив. Примеры:

#### Определение существования бандла:

	Bundle::exists('admin');

#### Выяснение местоположения бандла:

	$location = Bundle::path('admin');

#### Получение конфигурационного массива бандла:

	$config = Bundle::get('admin');

#### Получение всех имен бандлов приложения:

	$names = Bundle::names();

<a name="bundle-assets"></a>
## Ресурсы бандлов

Если у вашего бандла есть представление, то, скорее всего, там используются и CSS, и Javascript, и изображения, которые в приложении обычно доступны в папке **public**. Как использовать эти ресурсы в бандле? Просто создайте папку **public** в корневой директории бандла и разместите там ресурсы.

Хорошо, но как они попадают в папку **public** приложения? Для этого есть Artisan CLI. Простая команда опубликует ваши ресурсы бандла в папке **public** приложения:

#### Публикация ресурсов бандла в **public** директории:

	php artisan bundle:publish

Эта команда создаст папку с ресурсами бандла в директории **public/bundles** приложения. Например, если бандл называется 'admin', будет создана папка **public/bundles/admin**, которая будет содержать все необходимые файлы.

Дополнительно: [Управление ресурсами](/docs/views/assets#bundle-assets).

<a name="installing-bundles"></a>
## Установка бандла

Конечно же, вы можете легко установить бандл в приложение вручную. Тем не менее, Laravel предлагает "Artisan" CLI, что может существенно помочь в разработке. Для установки посредством Artisan фреймворк использует простые zip архивы для установки и обновления бандлов. Переде установкой спакуйте бандл в zip архив.

#### Установка бандла с Artisan:

	php artisan bundle:install eloquent

Все! Бандл установлен, осталось только [зарегистрировать его](#registering-bundles) и [опубликовать его ресурсы](#bundle-assets).

Нужно узнать, какие бандлы есть? Проверьте [директорию бандлов](http://bundles.laravel.com)

<a name="upgrading-bundles"></a>
## Обновление бандлов

Важно! При обновлении бандла старая папка уничтожается и записывается новая папка бандла с обновленным содержимым.

#### Обновление бандла с Artisan:

	php artisan bundle:upgrade eloquent

> **Примечание:** После обновления бандла [переопубликуйте его ресурсы](#bundle-assets).

**Важно:** Так как старый бандл полностью удаляется при обновлении, не забывайте сделать резервную копию, а также проконтролируйте конфигурации бандла на предмет изменений для избежания ошибок. В случае обновления бандла при работе приложения, рекомендуется для загрузки конфигурации бандла использовать класс событий. Разместите код в **application/start.php**.

#### Отслеживание события старта бандла:

	Event::listen('laravel.started: admin', function()
	{
		Config::set('admin::file.option', true);
	});
